<div class="modal-header">
	<h3 class="modal-title" jhiTranslate="fileManager.title"></h3>
	<button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="cancel()">&times;
	</button>
</div>
<div class="modal-body">
	<div class="row mb-3">
		<div class="col">
			<h4 jhiTranslate="fileManager.fileSection" class="border-bottom pb-3 mb-3"></h4>
			<i class="throbber float-right" *ngIf="isLoading"></i>
			<form>
				<div class="form-group row">
					<label class="col-sm-4 col-form-label" for="fileInput" jhiTranslate="fileManager.upload.file"></label>
					<div class="col-sm-6">
						<div class="input-group">
							<input type="file" class="custom-file-input" id="fileInput"
								   (change)="onFileChange($event)" accept="{{acceptedFileTypes}}">
							<label class="custom-file-label text-truncate" #fileUpload for="fileInput">
								<i class="fa fa-search"></i>&nbsp;<span jhiTranslate="fileManager.fileUpload.description"></span>
							</label>
						</div>
					</div>
					<div class="col-sm-2">
						<button class="btn btn-info" (click)="upload()" [disabled]="!file">
							<span jhiTranslate="fileManager.upload.button"></span>
						</button>
					</div>
				</div>
				<div class="form-group row">
					<label class="col-sm-4 col-form-label" for="variable" jhiTranslate="fileManager.upload.variable"></label>
					<div class="col-sm-6">
						<jhi-variable-select
							id="variable"
							[allowClear]="true"
							(onVariableSelectedChange)="variable = $event"
						></jhi-variable-select>
					</div>
				</div>
				<div class="form-group row">
					<div class="offset-3 col-sm-6">
					</div>
				</div>
			</form>
			<table class="table table-striped table-bordered table-curved">
				<thead>
				<tr>
					<th jhiTranslate="fileManager.fileName"></th>
					<th>
						<span jhiTranslate="fileManager.variable"></span>
						<jhi-column-filter-inline [filter]="filters.variable"
												  (onApply)="applyFilters()"
												  (onReset)="resetFilters()"></jhi-column-filter-inline>
					</th>
					<th jhiTranslate="fileManager.actions"></th>
				</tr>
				</thead>
				<tbody *ngIf="fileMetadataList && fileMetadataList.length else nodata">
				<tr *ngFor="let fileMetadata of fileMetadataList" (click)="select(fileMetadata)"
					[class.selected]="fileMetadataSelected && fileMetadataSelected.fileUUID == fileMetadata.fileUUID">
					<td>{{fileMetadata.name}}</td>
					<td>{{fileMetadata.variables?.length ? (fileMetadata.variables[0].alias || fileMetadata.variables[0].name) : ''}}</td>
					<td>
						<button class="btn btn-info mr-2" (click)="delete($event, fileMetadata)"><i class="fa fa-trash" aria-hidden="true"></i></button>
						<button class="btn btn-info" (click)="download($event, fileMetadata)">
							<i class="fa fa-download" aria-hidden="true"></i>
						</button>
					</td>
				</tr>
				</tbody>
				<ng-template #nodata>
					<tbody>
					<tr>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					</tbody>
				</ng-template>
			</table>
		</div>
	</div>
	<div class="row mb-3">
		<div class="col">
			<h4 jhiTranslate="fileManager.preview" class="border-bottom pb-3 mb-3"></h4>
			<div class="row">
				<div class="col">
					<!-- Preview image either from file selected... -->
					<div *ngIf="(fileMetadataSelected && fileMetadataSelected.path)">
						<div *ngIf="isImage(fileMetadataSelected.name) else nopreview">
							<!-- FIXME tiny blank image inserted by secureImage fires the load event -->
							<i class="throbber" *ngIf="isLoadingImage"></i>
							<img #img alt="" [src]="'/bmsapi/crops/' + context.cropName + '/files/' + fileMetadataSelected.path | secureImage | async" (load)="isLoadingImage = false" />
						</div>
					</div>
					<!-- ...or image to upload -->
					<div *ngIf="imgToUploadUrlPreview">
						<img alt="" [src]="imgToUploadUrlPreview" />
					</div>
					<!-- ... or there is nothing selected -->
					<div *ngIf="!(fileMetadataSelected && fileMetadataSelected.path)">
						<div *ngIf="!file else nopreview">
							<div class="text-center" jhiTranslate="fileManager.preview.select"></div>
						</div>
					</div>
					<!-- ... or there is something selected with no preview -->
					<ng-template #nopreview>
						<div class="text-center" jhiTranslate="fileManager.preview.not.available"></div>
					</ng-template>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="modal-footer">
	<button class="btn btn-default" jhiTranslate="cancel" (click)="cancel()"></button>
</div>
<jhi-alert></jhi-alert>
